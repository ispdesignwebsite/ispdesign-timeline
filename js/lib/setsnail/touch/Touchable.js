function Touchable(e,n,o){function t(e){var n=e.activeEvent.event;!0===i.preventDefault&&(e.activeEvent.phase===TouchPhase.MOVED&&BrowserDetect.TABLET||BrowserDetect.MOBILE?n.preventDefault():BrowserDetect.TABLET||BrowserDetect.MOBILE||n.preventDefault()),!0===i.stopPropagation&&n.stopPropagation();var o,t,c=n.touches||n.changedTouches,v=e.activeEvent.phase;a=c.length,v===TouchPhase.ENDED&&0===c.length&&(c=_preTouches,a=c.length);for(var s=0;s<a;s++)if(o=c.item(s),o)switch(l[o.identifier]||(l[o.identifier]=TouchInfo.getInfo(o,i.clickOrHold,i.clickOrUp,i.clickWithinBounds,r),null!==u&&u(l[o.identifier])),t=TouchInfo.getInfo(o,i.clickOrHold,i.clickOrUp,i.clickWithinBounds,r),h&&(h.touch=t.touch),v){case TouchPhase.BEGAN:t.handleBegan(),h&&s===a-1&&h.handleBegan();break;case TouchPhase.MOVED:t.handleMoved(),h&&s===a-1&&h.handleMoved();break;case TouchPhase.ENDED:t.handleEnded(),h&&s===a-1&&1==a&&h.handleEnded(),TouchInfo.pool(l[o.identifier]),delete l[o.identifier],a--}_preTouches=c}function c(){d||(v=new UnifiedTouch(r),v.onDown(t),v.onMove(t),v.onUp(t),d=!0,s&&i.enableAutokill())}var i;e?i=!0===o?e:{}:(i=document.createElement("div"),i.style.position="absolute");var u=null,l=[],a=null,h=null,v=null,r=e||i,s=null!=n&&n,f=null;i.clickOrHold=!1,i.clickOrUp=!1,i.clickWithinBounds=!1,i.preventDefault=!0,i.stopPropagation=!1,i.enableAutokill=function(){if(null===f){var e=1e3,n=0,o=!1;f=setInterval(function(){if(null!==r){var t=r.parentNode;if(n+=e,(!o||n>=2e4)&&(o=null!==t),null!==t){var c=!0;do{t===document&&(c=!1),t=t.parentNode}while(t);o&&c&&i.dispose()}else i.disableAutoKill()}else i.disableAutoKill()},e)}},i.disableAutoKill=function(){clearInterval(f),f=null},i.onDown=function(e,n){c(),n=n||-1;var o=i.getTouchInfo(n);o&&(o.onDown=e)},i.onUp=function(e,n){c(),n=n||-1;var o=i.getTouchInfo(n);o&&(o.onUp=e)},i.onMove=function(e,n){c(),n=n||-1;var o=i.getTouchInfo(n);o&&(o.onMove=e)},i.onClick=function(e,n){c(),n=n||-1;var o=i.getTouchInfo(n);o&&(o.onClick=e)},i.onHold=function(e,n){c(),n=n||-1;var o=i.getTouchInfo(n);o&&(o.onHold=e)},i.onOver=function(e,n){if(null!=e){c(),n=n||-1;var o=i.getTouchInfo(n);o&&(o.onOver=e)}},i.onOut=function(e,n){if(null!=e){c(),n=n||-1;var o=i.getTouchInfo(n);o&&(o.onOut=e)}},i.onNewTouch=function(e){null!=e&&(c(),u=e)},i.getTouchInfo=function(e){return e=void 0===e?-1:e,-1==e?(h||(h=new TouchInfo,h.clickOrHold=i.clickOrHold,h.clickOrUp=i.clickOrUp,h.clickWithinBounds=i.clickWithinBounds,h.listenOn=r),h):l[e]},i.numOfFingers=function(){return a},i.getListener=function(){return r},_preTouches=null;var d=!1;return i.dispose=function(){i.disableAutoKill(),d||null!==v&&(v.dispose(),v=null),d=!1},i}function UnifiedTouch(e){function n(){p.isTouch?(v("touchstart",e,o),v("touchmove",e,l),v("touchend",e,t)):v("mousedown",e,i)}function o(e){p.activeEvent.event=e,p.activeEvent.phase=TouchPhase.BEGAN,h(s)}function t(e){p.activeEvent.event=e,p.activeEvent.phase=TouchPhase.ENDED,h(f)}function c(e){p.activeEvent.event=e,p.activeEvent.phase=TouchPhase.MOVED,h(d)}function i(e){p.activeEvent.phase=TouchPhase.BEGAN,p.activeEvent.event=e,p.activeEvent.event.touches=a(e),h(s),v("mousemove",window,l),v("mouseup",window,u)}function u(e){p.activeEvent.phase=TouchPhase.ENDED,p.activeEvent.event=e,p.activeEvent.event.touches=a(e),h(f),r("mousemove",window,l),r("mouseup",window,u)}function l(e){p.activeEvent.phase=TouchPhase.MOVED,p.activeEvent.event=e,p.activeEvent.event.touches=a(e),h(d)}function a(e){return e.identifier=DesktopTouches.identifyInc,DesktopTouches.identifyInc++,new DesktopTouches(e)}function h(e){null!=e&&e(p)}function v(e,n,o){n.addEventListener?n.addEventListener(e,o,!1):n.attachEvent&&n.attachEvent("on"+e,o)}function r(e,n,o){n.removeEventListener?n.removeEventListener(e,o,!1):n.attachEvent&&n.detachEvent("on"+e,o)}var s,f,d,p={};return p.isTouch=BrowserDetect.TABLET||BrowserDetect.MOBILE,p.activeEvent={},p.onDown=function(e){s=e},p.onUp=function(e){f=e},p.onMove=function(e){d=e},p.dispose=function(){p.isTouch?(r("touchstart",e,o),r("touchmove",e,c),r("touchend",e,t)):(r("mousedown",e,i),r("mousemove",window,l),r("mouseup",window,u))},n(),p}function DesktopTouches(e){var n={length:1},o=[e];return n.item=function(e){return o[e]},n}Touchable.listen=function(e,n,o){o=null==o||o;var t=new Touchable(e,o);return t.clickOrUp=void 0!==n.clickOrUp&&n.clickOrUp,t.clickWithinBounds=void 0!==n.clickWithinBounds&&n.clickWithinBounds,t.clickOrHold=void 0!==n.useClickHold&&n.useClickHold,t.preventDefault=void 0===n.preventDefault||n.preventDefault,t.onDown(n.onDown),t.onMove(n.onMove),t.onClick(n.onClick),t.onUp(n.onUp),t.onOver(n.onOver),t.onOut(n.onOut),t},Touchable.apply=function(e,n){return new Touchable(e,n,!0)},TouchPhase={},TouchPhase.BEGAN=1,TouchPhase.MOVED=2,TouchPhase.ENDED=4,TouchPhase.HOVER=8,DesktopTouches.identifyInc=0;