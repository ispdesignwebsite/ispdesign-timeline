function PageTemplate(e){function t(e){if(!d.isScrolling()){var t=e.keyCode;37==t?u.scrollToPrevModule():39==t&&u.scrollToNextModule()}}function i(){clearTimeout(f),v+=1,f=setTimeout(n,400)}function n(){v===c.length&&o()}function o(){ContentManager.nextTemplate()}function l(e,t,i){e["resize_"+Assets.RESIZE_MANAGER.getBreakPoint()](t,i)}function s(){for(var e=c.length,t=0;t<e;t+=1)c[t].kill()}function r(){for(var e=c.length,t=null,i=0,n=0;n<e;n+=1)t=c[n],i=1/t.getWidth()*(d.currentScroll.y-t.aniGetX()+u.visibleWidth),t.visibilityRatio(i)}function a(){u.pageScrollRatio(d.getScrollRatio())}var u=document.createElement("div");u.style.position="absolute";var d=null,c=[];u.pageHeight=0,u.visibleWidth=0,u.visibleHeight=0;var g,h=null,v=0,f=null;return u.init=function(e,i){h=document.createElement("div"),h.style.position="absolute",u.appendChild(h);var n=e||Assets.LAYER_TEMPLATE;n.appendChild(u),d=Assets.SCROLL_CONTROLLER,Assets.RESIZE_MANAGER.addEventListener(ResizeEvents.RESIZE,u.onResize),u.setPageHeight(u.pageHeight),document.onkeydown=t,d.addEventListener(ScrollController.ON_SCROLL_MOVE,a)},u.addModule=function(e,t){if("function"!=typeof e.resize_desktop&&console.error("module must have resize(width, height) function"),"function"!=typeof e.getHeight&&console.error("module must have getHeight() function"),"function"!=typeof e.kill&&console.error("module must have kill() function"),h.appendChild(e),e.setCallbackLoaded(i),e.setCallbackResize(u.resizeModules),e.setCallbackReposition(u.repositionModules),e.init(),AnimationUtils.apply(e),t){var n=c.indexOf(t)+1;c.splice(n,0,e),u.resizeModules()}else c.push(e);return e},u.removeModule=function(e,t){var i=c.indexOf(e);return!1!==t&&(e.parentNode.removeChild(e),e.kill()),c.splice(i,1),i},u.templateIn=function(){null!=d&&d.scrollTo(0,0),Assets.MAIN_MENU.isCollapsed()?TweenMax.to(Assets.LAYER_BOT,1,{x:0,onComplete:function(){ContentManager.nextTemplate()},ease:Expo.easeInOut}):(Assets.MAIN_MENU.collapseMenu(1,Expo.easeInOut),setTimeout(function(){ContentManager.nextTemplate()},1e3))},u.templateOut=function(){Assets.MAIN_MENU.isCollapsed()?(d.scrollTo(0,.6,Expo.easeInOut),TweenMax.to(Assets.LAYER_BOT,.6,{x:u.visibleWidth,onComplete:function(){u.kill(),ContentManager.nextTemplate()},ease:Expo.easeInOut})):(Assets.MAIN_MENU.openWide(.6),setTimeout(function(){d.scrollTo(0,0),u.kill(),ContentManager.nextTemplate()},600))},u.onResize=function(){u.visibleWidth=Assets.RESIZE_MANAGER.getWindowWidth()-MainMenu.BORDER_WIDTH,u.visibleHeight=Assets.RESIZE_MANAGER.getWindowHeight(),u.style.width=u.visibleWidth+"px",u.style.height=u.visibleHeight+"px",u.resizeModules()},u.resizeModules=function(e){var t=c.length,i=null;if(0!==t){var n=0;if(e){var o=c.indexOf(e);-1!==o&&(i=c[o],l(i,u.visibleWidth,u.visibleHeight),u.repositionModules(i))}else{for(var s=0;s<t;s+=1)i=c[s],l(i,u.visibleWidth,u.visibleHeight),i.aniSetX(n),i.aniRender(),n+=i.getWidth();u.pageHeight=n,u.setPageHeight(u.pageHeight)}a()}},u.repositionModules=function(e){var t=c.length,i=null;if(0!==t){var n=Assets.MAIN_MENU.menuOffsetH,o=e?c.indexOf(e):0;-1===o&&(o=0),e&&0!==o&&(i=c[o-1],n=parseInt(i.aniGetX(),10)+i.getWidth());for(var l=o;l<t;l+=1)i=c[l],i.aniSetX(n),i.aniRender(),n+=i.getWidth();t>1&&i&&n<u.visibleHeight?(n=u.visibleWidth-i.getWidth(),i.aniSetX(n),i.aniRender(),u.visibleWidth=n):n<u.visibleHeight&&(n=u.visibleWidth),u.pageHeight=n,u.setPageHeight(u.pageHeight),r()}},u.setPageHeight=function(e){d.setPageHeight(e)},u.kill=function(){Assets.RESIZE_MANAGER.removeEventListener(ResizeEvents.RESIZE,u.onResize),d.removeEventListener(ScrollController.ON_SCROLL_MOVE,a),s(),u.parentNode.removeChild(u)},u.ignoreScrollAfter=function(e){g=e},u.pageScrollRatio=function(e){var t=d.getPageHeight(),i=0,n=t-d.getScrollRatio()*t;if(null!=g&&n<g){e=(g-n)/g;i=g*Power1.easeIn.getRatio(e)}TweenMax.set(Assets.LAYER_TEMPLATE,{x:-Assets.SCROLL_CONTROLLER.currentScroll.y+i}),r()},u.getCurrentScrolledIndex=function(){for(var e=c.length,t=0;t<e;t+=1){var i=d.currentScroll.y-c[t].aniGetX();if(i<-1)return t-1}return 0},u.scrollToNextModule=function(){var e=u.getCurrentScrolledIndex()+1;e>=c.length&&(e=c.length-1),d.scrollTo(c[e].aniGetX(),1,Expo.easeInOut)},u.scrollToPrevModule=function(){var e=u.getCurrentScrolledIndex()-1;e<0&&(e=0),d.scrollTo(c[e].aniGetX(),1,Expo.easeInOut)},u}